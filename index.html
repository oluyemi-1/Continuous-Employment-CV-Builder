<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Continuous Employment CV Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .hidden { display: none; }
        .modal-backdrop {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-xl p-8 my-6">
        <h1 class="text-3xl font-bold text-blue-900 mb-2">Continuous Employment CV Builder</h1>
        <p class="text-gray-600 mb-8">Track your complete work history from age 16 with no gaps</p>

        <!-- Personal Information Section -->
        <div class="mb-8 p-6 bg-blue-50 rounded-lg">
            <h2 class="text-xl font-semibold text-blue-900 mb-4">Personal Information</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <input type="text" id="fullName" placeholder="Full Name *" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <input type="email" id="email" placeholder="Email *" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <input type="tel" id="phone" placeholder="Phone *" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <input type="text" id="postcode" placeholder="Postcode *" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <input type="text" id="address" placeholder="Address *" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent md:col-span-2">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Date of Birth *</label>
                    <input type="date" id="dateOfBirth" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent w-full">
                    <div id="ageInfo" class="mt-2 text-sm hidden">
                        <p class="text-gray-600">Current Age: <span id="currentAge"></span></p>
                        <p class="text-blue-600 font-medium">You turned 16 on: <span id="age16Date"></span></p>
                        <p class="text-orange-600 mt-1">‚ö†Ô∏è No gap should exceed 14 days between entries</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Unsaved Warning -->
        <div id="unsavedWarning" class="mb-6 p-4 bg-yellow-50 border border-yellow-300 rounded-lg hidden">
            <p class="text-yellow-800 font-semibold">‚ö†Ô∏è You have unsaved changes. Please save your entry before proceeding.</p>
        </div>

        <!-- Gap Detection -->
        <div id="gapWarning" class="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg hidden">
            <div class="flex items-start">
                <svg class="text-red-600 mr-3 mt-1 flex-shrink-0" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"></circle>
                    <line x1="12" y1="8" x2="12" y2="12"></line>
                    <line x1="12" y1="16" x2="12.01" y2="16"></line>
                </svg>
                <div class="flex-1">
                    <h3 class="font-semibold text-red-900 mb-2">Employment Gaps Detected</h3>
                    <div id="gapList"></div>
                    <p class="text-red-700 text-sm mt-2">Please add entries to cover these periods or use our smart suggestions</p>
                </div>
            </div>
        </div>

        <!-- Employment History Section -->
        <div class="mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-semibold text-blue-900">Employment History</h2>
                <div class="flex gap-2">
                    <button id="customTypeBtn" class="flex items-center gap-2 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition text-sm">
                        + Custom Type
                    </button>
                    <button id="addEntryBtn" class="flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Add Entry
                    </button>
                </div>
            </div>

            <div id="firstEntryHelp" class="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg hidden">
                <p class="text-blue-800 text-sm">
                    üìÖ <strong>Start your first entry from: <span id="startDate"></span></strong> (when you turned 16)
                </p>
                <p class="text-blue-700 text-sm mt-1">
                    Click "Add Entry" to begin. Start with your most recent/current position.
                </p>
            </div>

            <div id="employmentEntries"></div>
        </div>

        <!-- Education Section -->
        <div id="educationSection" class="mb-6 hidden">
            <h2 class="text-xl font-semibold text-blue-900 mb-4">Education</h2>
            <div id="educationEntries"></div>
        </div>

        <!-- Action Buttons -->
        <div class="flex gap-4 flex-wrap">
            <button id="downloadBtn" class="flex items-center gap-2 bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition font-semibold">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Download CV
            </button>
            <button id="shareBtn" class="flex items-center gap-2 bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition font-semibold">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="18" cy="5" r="3"></circle>
                    <circle cx="6" cy="12" r="3"></circle>
                    <circle cx="18" cy="19" r="3"></circle>
                    <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
                    <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
                </svg>
                Share CV
            </button>
            <button id="checkGapsBtn" class="flex items-center gap-2 bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-semibold">
                Check for Gaps
            </button>
        </div>

        <!-- Success Message -->
        <div id="successMessage" class="mt-4 p-4 bg-green-50 border border-green-200 rounded-lg hidden">
            <p class="text-green-800 font-semibold">‚úì No gaps detected! Your employment history is complete.</p>
        </div>
    </div>

    <!-- Modals will be inserted here by JavaScript -->

    <script>
        // Application State
        const state = {
            personalInfo: {
                fullName: '',
                email: '',
                phone: '',
                address: '',
                postcode: '',
                dateOfBirth: '',
                currentAge: '',
                age16Date: ''
            },
            entries: [],
            gaps: [],
            customTypes: [],
            unsavedEntryId: null
        };

        const defaultTypes = [
            'employment', 'education', 'unemployment', 'job seeking',
            'gap year', 'travel', 'self-employed', 'volunteer',
            'career break', 'parental leave', 'sabbatical', 'freelancing'
        ];

        // Utility Functions
        function calculateAge(dob) {
            if (!dob) return { age: '', age16Date: '' };
            const today = new Date();
            const birthDate = new Date(dob);
            let age = today.getFullYear() - birthDate.getFullYear();
            const m = today.getMonth() - birthDate.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birthDate.getDate())) {
                age--;
            }
            
            const age16 = new Date(birthDate);
            age16.setFullYear(age16.getFullYear() + 16);
            const age16DateStr = age16.toISOString().split('T')[0];
            
            return { age, age16Date: age16DateStr };
        }

        function getNextExpectedDate() {
            if (!state.personalInfo.age16Date) return null;
            
            if (state.entries.length === 0) {
                return state.personalInfo.age16Date;
            }
            
            const sortedEntries = [...state.entries].sort((a, b) => 
                new Date(b.startDate) - new Date(a.startDate)
            );
            
            const latestEntry = sortedEntries[0];
            if (latestEntry.isCurrent) return null;
            
            const endDate = new Date(latestEntry.endDate);
            endDate.setDate(endDate.getDate() + 1);
            return endDate.toISOString().split('T')[0];
        }

        function validateEntry(entry) {
            const errors = [];
            
            if (!entry.title?.trim()) errors.push('Job Title/Activity is required');
            if (!entry.company?.trim()) errors.push('Company/Institution is required');
            if (!entry.startDate) errors.push('Start Date is required');
            if (!entry.isCurrent && !entry.endDate) errors.push('End Date is required (or check Current)');
            if (!entry.description?.trim()) errors.push('Description is required');
            
            const expectedDate = getNextExpectedDate();
            if (expectedDate && entry.startDate) {
                const entryStart = new Date(entry.startDate);
                const expected = new Date(expectedDate);
                const diffDays = Math.abs((entryStart - expected) / (1000 * 60 * 60 * 24));
                
                if (diffDays > 14) {
                    errors.push(`Start date should be within 14 days of ${expectedDate}. Current gap: ${Math.floor(diffDays)} days`);
                }
            }
            
            if (entry.startDate && entry.endDate && !entry.isCurrent) {
                if (new Date(entry.endDate) < new Date(entry.startDate)) {
                    errors.push('End date cannot be before start date');
                }
            }
            
            return errors;
        }

        function checkForGaps() {
            if (!state.personalInfo.dateOfBirth || state.entries.length === 0) return;

            const startDate = new Date(state.personalInfo.dateOfBirth);
            startDate.setFullYear(startDate.getFullYear() + 16);

            const sortedEntries = [...state.entries].sort((a, b) => 
                new Date(a.startDate) - new Date(b.startDate)
            );

            const foundGaps = [];
            let currentDate = startDate;

            sortedEntries.forEach((entry) => {
                const entryStart = new Date(entry.startDate);
                
                if (entryStart > currentDate) {
                    const gapDays = Math.floor((entryStart - currentDate) / (1000 * 60 * 60 * 24));
                    if (gapDays > 0) {
                        foundGaps.push({
                            start: currentDate.toISOString().split('T')[0],
                            end: new Date(entryStart.getTime() - 86400000).toISOString().split('T')[0],
                            days: gapDays
                        });
                    }
                }

                currentDate = entry.isCurrent ? new Date() : new Date(entry.endDate);
                currentDate.setDate(currentDate.getDate() + 1);
            });

            const today = new Date();
            if (currentDate < today) {
                const gapDays = Math.floor((today - currentDate) / (1000 * 60 * 60 * 24));
                if (gapDays > 0) {
                    foundGaps.push({
                        start: currentDate.toISOString().split('T')[0],
                        end: today.toISOString().split('T')[0],
                        days: gapDays
                    });
                }
            }

            state.gaps = foundGaps;
            renderGaps();
        }

        // Render Functions
        function renderGaps() {
            const gapWarning = document.getElementById('gapWarning');
            const gapList = document.getElementById('gapList');
            const successMessage = document.getElementById('successMessage');
            
            if (state.gaps.length > 0 && !state.unsavedEntryId) {
                gapWarning.classList.remove('hidden');
                successMessage.classList.add('hidden');
                
                gapList.innerHTML = state.gaps.map((gap, index) => `
                    <div class="flex justify-between items-center mb-2 flex-wrap gap-2">
                        <p class="text-red-800 text-sm">
                            Gap from ${gap.start} to ${gap.end} (${gap.days} days)
                        </p>
                        <button onclick="suggestGapFill(${index})" class="flex items-center gap-1 bg-yellow-500 text-white px-3 py-1 rounded text-sm hover:bg-yellow-600 transition">
                            üí° Suggest
                        </button>
                    </div>
                `).join('');
            } else {
                gapWarning.classList.add('hidden');
                if (state.entries.length > 0 && state.personalInfo.dateOfBirth && !state.unsavedEntryId) {
                    successMessage.classList.remove('hidden');
                } else {
                    successMessage.classList.add('hidden');
                }
            }
        }

        function renderEntries() {
            const employmentContainer = document.getElementById('employmentEntries');
            const educationContainer = document.getElementById('educationEntries');
            const educationSection = document.getElementById('educationSection');
            
            const employmentEntries = state.entries.filter(e => e.type !== 'education');
            const educationEntries = state.entries.filter(e => e.type === 'education');
            
            // Render employment entries
            employmentContainer.innerHTML = employmentEntries.map(entry => createEntryHTML(entry)).join('');
            
            // Render education entries
            if (educationEntries.length > 0) {
                educationSection.classList.remove('hidden');
                educationContainer.innerHTML = educationEntries.map(entry => createEntryHTML(entry)).join('');
            } else {
                educationSection.classList.add('hidden');
            }
            
            // Show first entry help
            const firstEntryHelp = document.getElementById('firstEntryHelp');
            if (state.personalInfo.age16Date && state.entries.length === 0) {
                firstEntryHelp.classList.remove('hidden');
                document.getElementById('startDate').textContent = state.personalInfo.age16Date;
            } else {
                firstEntryHelp.classList.add('hidden');
            }
        }

        function createEntryHTML(entry) {
            const allTypes = [...defaultTypes, ...state.customTypes];
            const typeOptions = entry.type === 'education' 
                ? allTypes.map(t => `<option value="${t}" ${t === entry.type ? 'selected' : ''}>${t.charAt(0).toUpperCase() + t.slice(1)}</option>`).join('')
                : allTypes.filter(t => t !== 'education').map(t => `<option value="${t}" ${t === entry.type ? 'selected' : ''}>${t.charAt(0).toUpperCase() + t.slice(1)}</option>`).join('');
            
            const expectedDate = getNextExpectedDate();
            const showExpectedDate = expectedDate && entry.id === state.unsavedEntryId;
            
            return `
                <div class="mb-6 p-6 rounded-lg border-2 ${entry.isNew ? 'bg-yellow-50 border-yellow-300' : 'bg-gray-50 border-gray-200'}">
                    <div class="flex justify-between items-start mb-4">
                        <select onchange="updateEntryField(${entry.id}, 'type', this.value)" class="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 capitalize">
                            ${typeOptions}
                        </select>
                        <button onclick="deleteEntry(${entry.id})" class="text-red-600 hover:text-red-800">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="3 6 5 6 21 6"></polyline>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                                <line x1="10" y1="11" x2="10" y2="17"></line>
                                <line x1="14" y1="11" x2="14" y2="17"></line>
                            </svg>
                        </button>
                    </div>

                    ${showExpectedDate ? `
                        <div class="mb-4 p-3 bg-blue-100 border border-blue-300 rounded text-sm">
                            <p class="text-blue-900">
                                üìÖ <strong>Expected start date: ${expectedDate}</strong>
                            </p>
                            <p class="text-blue-800 mt-1">
                                Your start date should be within 14 days of this date to avoid gaps
                            </p>
                        </div>
                    ` : ''}

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <input type="text" placeholder="${entry.type === 'education' ? 'Course / Qualification' : 'Job Title / Activity'} *" value="${entry.title}" oninput="updateEntryField(${entry.id}, 'title', this.value)" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <input type="text" placeholder="${entry.type === 'education' ? 'Institution' : 'Company / Institution'} *" value="${entry.company}" oninput="updateEntryField(${entry.id}, 'company', this.value)" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        <input type="text" placeholder="Location" value="${entry.location}" oninput="updateEntryField(${entry.id}, 'location', this.value)" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm text-gray-700 mb-1">Start Date *</label>
                            <input type="date" value="${entry.startDate}" onchange="updateEntryField(${entry.id}, 'startDate', this.value)" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 w-full">
                        </div>
                        <div>
                            <label class="block text-sm text-gray-700 mb-1">End Date *</label>
                            <div class="flex items-center gap-2">
                                <input type="date" value="${entry.endDate}" onchange="updateEntryField(${entry.id}, 'endDate', this.value)" ${entry.isCurrent ? 'disabled' : ''} class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 flex-1 ${entry.isCurrent ? 'bg-gray-100' : ''}">
                                <label class="flex items-center gap-2 text-sm">
                                    <input type="checkbox" ${entry.isCurrent ? 'checked' : ''} onchange="updateEntryField(${entry.id}, 'isCurrent', this.checked)" class="w-4 h-4">
                                    Current
                                </label>
                            </div>
                        </div>
                    </div>

                    <textarea placeholder="${entry.type === 'education' ? 'Description of course, achievements, grades...' : 'Description of responsibilities, achievements, or activities...'} *" oninput="updateEntryField(${entry.id}, 'description', this.value)" rows="3" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 mb-4">${entry.description}</textarea>

                    ${entry.isNew ? `
                        <button onclick="saveEntry(${entry.id})" class="w-full flex items-center justify-center gap-2 bg-green-600 text-white px-4 py-3 rounded-lg hover:bg-green-700 transition font-semibold">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                                <polyline points="17 21 17 13 7 13 7 21"></polyline>
                                <polyline points="7 3 7 8 15 8"></polyline>
                            </svg>
                            Save Entry
                        </button>
                    ` : ''}
                </div>
            `;
        }

        // Event Handlers
        function addEntry() {
            if (state.unsavedEntryId) {
                alert('Please save your current entry first');
                return;
            }
            
            const expectedDate = getNextExpectedDate();
            const newEntry = {
                id: Date.now(),
                type: 'employment',
                title: '',
                company: '',
                location: '',
                startDate: expectedDate || '',
                endDate: '',
                isCurrent: false,
                description: '',
                isNew: true
            };
            
            state.entries.unshift(newEntry);
            state.unsavedEntryId = newEntry.id;
            document.getElementById('unsavedWarning').classList.remove('hidden');
            renderEntries();
            updateButtonStates();
        }

        function updateEntryField(id, field, value) {
            const entry = state.entries.find(e => e.id === id);
            if (!entry) return;
            
            if (field === 'isCurrent') {
                entry.isCurrent = value;
                if (value) entry.endDate = '';
            } else {
                entry[field] = value;
            }
            
            renderEntries();
        }

        function saveEntry(id) {
            const entry = state.entries.find(e => e.id === id);
            if (!entry) return;
            
            const errors = validateEntry(entry);
            if (errors.length > 0) {
                alert('Please fix the following errors:\n\n' + errors.join('\n'));
                return;
            }
            
            entry.isNew = false;
            state.unsavedEntryId = null;
            document.getElementById('unsavedWarning').classList.add('hidden');
            
            alert('Entry saved successfully!');
            renderEntries();
            checkForGaps();
            updateButtonStates();
        }

        function deleteEntry(id) {
            if (!confirm('Are you sure you want to delete this entry?')) return;
            
            state.entries = state.entries.filter(e => e.id !== id);
            if (state.unsavedEntryId === id) {
                state.unsavedEntryId = null;
                document.getElementById('unsavedWarning').classList.add('hidden');
            }
            
            renderEntries();
            checkForGaps();
            updateButtonStates();
        }

        function updateButtonStates() {
            const addBtn = document.getElementById('addEntryBtn');
            const customBtn = document.getElementById('customTypeBtn');
            const downloadBtn = document.getElementById('downloadBtn');
            const shareBtn = document.getElementById('shareBtn');
            
            if (state.unsavedEntryId) {
                addBtn.disabled = true;
                customBtn.disabled = true;
                downloadBtn.disabled = true;
                shareBtn.disabled = true;
                addBtn.classList.add('opacity-50', 'cursor-not-allowed');
                customBtn.classList.add('opacity-50', 'cursor-not-allowed');
                downloadBtn.classList.add('opacity-50', 'cursor-not-allowed');
                shareBtn.classList.add('opacity-50', 'cursor-not-allowed');
            } else {
                addBtn.disabled = false;
                customBtn.disabled = false;
                downloadBtn.disabled = false;
                shareBtn.disabled = false;
                addBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                customBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                downloadBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                shareBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        }

        // Initialize Event Listeners
        document.getElementById('dateOfBirth').addEventListener('change', function(e) {
            const { age, age16Date } = calculateAge(e.target.value);
            state.personalInfo.dateOfBirth = e.target.value;
            state.personalInfo.currentAge = age;
            state.personalInfo.age16Date = age16Date;
            
            if (age) {
                document.getElementById('currentAge').textContent = age;
                document.getElementById('age16Date').textContent = age16Date;
                document.getElementById('ageInfo').classList.remove('hidden');
            }
            
            renderEntries();
        });

        document.getElementById('fullName').addEventListener('input', (e) => state.personalInfo.fullName = e.target.value);
        document.getElementById('email').addEventListener('input', (e) => state.personalInfo.email = e.target.value);
        document.getElementById('phone').addEventListener('input', (e) => state.personalInfo.phone = e.target.value);
        document.getElementById('address').addEventListener('input', (e) => state.personalInfo.address = e.target.value);
        document.getElementById('postcode').addEventListener('input', (e) => state.personalInfo.postcode = e.target.value);

        document.getElementById('addEntryBtn').addEventListener('click', addEntry);
        document.getElementById('checkGapsBtn').addEventListener('click', checkForGaps);

        document.getElementById('downloadBtn').addEventListener('click', function() {
            if (state.unsavedEntryId) {
                alert('Please save your current entry before downloading');
                return;
            }
            
            checkForGaps();
            
            if (state.gaps.length > 0) {
                alert('Please fill all employment gaps before downloading your CV');
                return;
            }

            generatePDF();
        });

        // PDF Generation
        function generatePDF() {
            const sortedEntries = [...state.entries].sort((a, b) => 
                new Date(b.startDate) - new Date(a.startDate)
            );

            const employmentEntries = sortedEntries.filter(e => e.type !== 'education');
            const educationEntries = sortedEntries.filter(e => e.type === 'education');

            let content = `
              <!DOCTYPE html>
              <html>
                <head>
                  <meta charset="UTF-8">
                  <title>${state.personalInfo.fullName} - CV</title>
                  <style>
                    @page { size: A4; margin: 20mm; }
                    * { margin: 0; padding: 0; box-sizing: border-box; }
                    body {
font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                      line-height: 1.6;
                      color: #333;
                      background: white;
                      padding: 20px;
                    }
                    .container { max-width: 800px; margin: 0 auto; }
                    h1 { 
                      color: #2563eb;
                      font-size: 32px;
                      border-bottom: 4px solid #2563eb;
                      padding-bottom: 12px;
                      margin-bottom: 20px;
                    }
                    h2 { 
                      color: #1e40af;
                      font-size: 24px;
                      margin-top: 30px;
                      margin-bottom: 20px;
                      border-bottom: 2px solid #e5e7eb;
                      padding-bottom: 8px;
                    }
                    .personal-info { 
                      margin-bottom: 30px;
                      background: #f8fafc;
                      padding: 20px;
                      border-radius: 8px;
                      border-left: 4px solid #2563eb;
                    }
                    .personal-info p { margin-bottom: 8px; font-size: 14px; }
                    .personal-info strong {
                      color: #1e40af;
                      display: inline-block;
                      width: 120px;
                    }
                    .entry { 
                      margin-bottom: 25px;
                      page-break-inside: avoid;
                      border-left: 3px solid #e5e7eb;
                      padding-left: 20px;
                    }
                    .entry-header { 
                      font-weight: bold;
                      font-size: 18px;
                      color: #1e40af;
                      margin-bottom: 5px;
                    }
                    .entry-meta { color: #666; font-size: 14px; margin-bottom: 10px; }
                    .entry-company { font-weight: 600; color: #374151; }
                    .entry-dates { color: #6b7280; font-style: italic; }
                    .entry-type {
                      display: inline-block;
                      background: #dbeafe;
                      color: #1e40af;
                      padding: 2px 8px;
                      border-radius: 4px;
                      font-size: 12px;
                      margin-left: 8px;
                      text-transform: capitalize;
                    }
                    .description { 
                      margin-top: 10px;
                      line-height: 1.7;
                      color: #4b5563;
                      font-size: 14px;
                    }
                    .footer {
                      margin-top: 40px;
                      padding-top: 20px;
                      border-top: 2px solid #e5e7eb;
                      text-align: center;
                      color: #9ca3af;
                      font-size: 12px;
                    }
                    @media print {
                      body { padding: 0; }
                      .no-print { display: none; }
                    }
                  </style>
                </head>
                <body>
                  <div class="container">
                    <h1>${state.personalInfo.fullName}</h1>
                    <div class="personal-info">
                      <p><strong>Email:</strong> ${state.personalInfo.email}</p>
                      <p><strong>Phone:</strong> ${state.personalInfo.phone}</p>
                      <p><strong>Address:</strong> ${state.personalInfo.address}</p>
                      <p><strong>Postcode:</strong> ${state.personalInfo.postcode}</p>
                      <p><strong>Date of Birth:</strong> ${state.personalInfo.dateOfBirth} (Age: ${state.personalInfo.currentAge})</p>
                    </div>
                    
                    <h2>Employment History (Age 16 to Present)</h2>
            `;

            employmentEntries.forEach(entry => {
                const typeLabel = entry.type !== 'employment' 
                    ? `<span class="entry-type">${entry.type.charAt(0).toUpperCase() + entry.type.slice(1)}</span>`
                    : '';
                
                content += `
                    <div class="entry">
                      <div class="entry-header">${entry.title} ${typeLabel}</div>
                      <div class="entry-meta">
                        <span class="entry-company">${entry.company}</span>${entry.location ? `, ${entry.location}` : ''}<br>
                        <span class="entry-dates">${entry.startDate} - ${entry.isCurrent ? 'Present' : entry.endDate}</span>
                      </div>
                      ${entry.description ? `<div class="description">${entry.description}</div>` : ''}
                    </div>
                `;
            });

            if (educationEntries.length > 0) {
                content += '<h2>Education</h2>';
                educationEntries.forEach(entry => {
                    content += `
                        <div class="entry">
                          <div class="entry-header">${entry.title}</div>
                          <div class="entry-meta">
                            <span class="entry-company">${entry.company}</span>${entry.location ? `, ${entry.location}` : ''}<br>
                            <span class="entry-dates">${entry.startDate} - ${entry.isCurrent ? 'Present' : entry.endDate}</span>
                          </div>
                          ${entry.description ? `<div class="description">${entry.description}</div>` : ''}
                        </div>
                    `;
                });
            }

            const today = new Date().toLocaleDateString('en-GB', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });

            content += `
                    <div class="footer">
                      <p>Curriculum Vitae - Generated on ${today}</p>
                      <p>Complete continuous employment history with no gaps from age 16 to present</p>
                    </div>
                  </div>
                  <div class="no-print" style="position: fixed; top: 20px; right: 20px; background: white; padding: 15px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1);">
                    <button onclick="window.print()" style="background: #2563eb; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; margin-bottom: 10px; width: 100%;">
                      Save as PDF / Print
                    </button>
                    <button onclick="window.close()" style="background: #6b7280; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; font-size: 16px; width: 100%;">
                      Close
                    </button>
                  </div>
                </body>
              </html>
            `;

            const printWindow = window.open('', '_blank');
            printWindow.document.write(content);
            printWindow.document.close();
        }

        // Share functionality
        document.getElementById('shareBtn').addEventListener('click', async function() {
            if (state.unsavedEntryId) {
                alert('Please save your current entry before sharing');
                return;
            }
            
            checkForGaps();
            
            if (state.gaps.length > 0) {
                alert('Please fill all employment gaps before sharing your CV');
                return;
            }

            // Create share modal
            const modal = document.createElement('div');
            modal.className = 'modal-backdrop';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-md w-11/12">
                    <h3 class="text-lg font-bold text-blue-900 mb-4">Share Your CV</h3>
                    <div class="flex flex-col gap-3">
                        <a href="https://wa.me/?text=${encodeURIComponent('Check out my CV: ' + window.location.href)}" target="_blank" class="block bg-green-600 text-white text-center py-3 px-4 rounded-lg font-semibold hover:bg-green-700 transition">
                            üì± Share via WhatsApp
                        </a>
                        <a href="mailto:?subject=${encodeURIComponent(state.personalInfo.fullName + ' - CV')}&body=${encodeURIComponent('Please find my CV at: ' + window.location.href)}" class="block bg-blue-600 text-white text-center py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 transition">
                            ‚úâÔ∏è Share via Email
                        </a>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="bg-gray-400 text-white py-3 px-4 rounded-lg font-semibold hover:bg-gray-500 transition">
                            Close
                        </button>
                    </div>
                </div>
            `;
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            document.body.appendChild(modal);
        });

        // Custom type functionality
        document.getElementById('customTypeBtn').addEventListener('click', function() {
            if (state.unsavedEntryId) {
                alert('Please save your current entry first');
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal-backdrop';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-md w-11/12">
                    <h3 class="text-lg font-bold text-blue-900 mb-4">Add Custom Entry Type</h3>
                    <input type="text" id="customTypeInput" placeholder="e.g., Career Break, Internship, etc." class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 mb-4">
                    <div class="flex gap-3">
                        <button onclick="addCustomType()" class="flex-1 bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition font-semibold">
                            Add Type
                        </button>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="flex-1 bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500 transition font-semibold">
                            Cancel
                        </button>
                    </div>
                </div>
            `;
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            document.body.appendChild(modal);
            
            setTimeout(() => {
                document.getElementById('customTypeInput').focus();
            }, 100);
        });

        function addCustomType() {
            const input = document.getElementById('customTypeInput');
            const value = input.value.trim().toLowerCase();
            
            if (value && ![...defaultTypes, ...state.customTypes].includes(value)) {
                state.customTypes.push(value);
                alert('Custom type added successfully!');
                document.querySelector('.modal-backdrop').remove();
            } else if (!value) {
                alert('Please enter a type name');
            } else {
                alert('This type already exists');
            }
        }

        // Gap suggestion functionality
        function suggestGapFill(gapIndex) {
            const gap = state.gaps[gapIndex];
            const sortedEntries = [...state.entries].sort((a, b) => 
                new Date(a.startDate) - new Date(b.startDate)
            );
            
            const gapStartDate = new Date(gap.start);
            let previousEntry = null;
            let nextEntry = null;
            
            for (let i = sortedEntries.length - 1; i >= 0; i--) {
                const endDate = sortedEntries[i].isCurrent ? new Date() : new Date(sortedEntries[i].endDate);
                if (endDate <= gapStartDate) {
                    previousEntry = sortedEntries[i];
                    break;
                }
            }
            
            for (let i = 0; i < sortedEntries.length; i++) {
                const startDate = new Date(sortedEntries[i].startDate);
                if (startDate >= gapStartDate) {
                    nextEntry = sortedEntries[i];
                    break;
                }
            }
            
            const suggestion = getGapSuggestion(gap, previousEntry, nextEntry);
            
            const modal = document.createElement('div');
            modal.className = 'modal-backdrop';
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-md w-11/12">
                    <h3 class="text-lg font-bold text-blue-900 mb-4">Smart Gap Suggestion</h3>
                    <div class="mb-4 p-4 bg-yellow-50 border border-yellow-200 rounded">
                        <p class="text-sm text-gray-700 mb-2">
                            <strong>Gap Period:</strong> ${gap.start} to ${gap.end} (${gap.days} days)
                        </p>
                        <p class="text-sm text-gray-700 mb-2">
                            <strong>Suggested Type:</strong> <span class="capitalize">${suggestion.type}</span>
                        </p>
                        <p class="text-sm text-gray-700 mb-2">
                            <strong>Title:</strong> ${suggestion.title}
                        </p>
                        <p class="text-sm text-gray-700">
                            <strong>Description:</strong> ${suggestion.description}
                        </p>
                    </div>
                    <div class="flex gap-3">
                        <button onclick="applyGapSuggestion(${JSON.stringify(gap).replace(/"/g, '&quot;')}, ${JSON.stringify(suggestion).replace(/"/g, '&quot;')})" class="flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition font-semibold">
                            Apply Suggestion
                        </button>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" class="flex-1 bg-gray-400 text-white px-4 py-2 rounded-lg hover:bg-gray-500 transition font-semibold">
                            Cancel
                        </button>
                    </div>
                </div>
            `;
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.remove();
                }
            });
            
            document.body.appendChild(modal);
        }

        function getGapSuggestion(gap, previousEntry, nextEntry) {
            const gapDuration = gap.days;
            
            if (previousEntry?.type === 'education' && nextEntry?.type === 'employment') {
                return {
                    type: 'job seeking',
                    title: 'Job Search Period',
                    company: 'N/A',
                    description: 'Actively searching for employment opportunities after completing education'
                };
            }
            
            if (previousEntry?.type === 'employment' && nextEntry?.type === 'employment') {
                if (gapDuration < 90) {
                    return {
                        type: 'job seeking',
                        title: 'Career Transition',
                        company: 'N/A',
                        description: 'Period of job search and career transition between positions'
                    };
                } else {
                    return {
                        type: 'career break',
                        title: 'Career Break',
                        company: 'N/A',
                        description: 'Planned career break for personal development and exploration'
                    };
                }
            }
            
            if (previousEntry?.type === 'education') {
                return {
                    type: 'job seeking',
                    title: 'Graduate Job Search',
                    company: 'N/A',
                    description: 'Seeking employment opportunities as a recent graduate'
                };
            }
            
            if (gapDuration < 60) {
                return {
                    type: 'unemployment',
                    title: 'Between Positions',
                    company: 'N/A',
                    description: 'Brief period between positions'
                };
            }
            
            return {
                type: 'unemployment',
                title: 'Unemployed',
                company: 'N/A',
                description: 'Period of unemployment'
            };
        }

        function applyGapSuggestion(gap, suggestion) {
            const newEntry = {
                id: Date.now(),
                type: suggestion.type,
                title: suggestion.title,
                company: suggestion.company,
                location: '',
                startDate: gap.start,
                endDate: gap.end,
                isCurrent: false,
                description: suggestion.description,
                isNew: false
            };
            
            state.entries.push(newEntry);
            document.querySelector('.modal-backdrop').remove();
            renderEntries();
            checkForGaps();
        }

        // Initialize on page load
        renderEntries();
    </script>
</body>
</html>
